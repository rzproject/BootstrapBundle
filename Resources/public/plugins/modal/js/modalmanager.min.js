(function(c){function g(a){return function(b){if(this===b.target)return a.apply(this,arguments)}}var h=function(a,b){this.init(a,b)};h.prototype={constructor:h,init:function(a,b){this.$element=c(a);this.options=c.extend({},c.fn.modalmanager.defaults,this.$element.data(),typeof b=="object"&&b);this.stack=[];this.backdropCount=0;if(this.options.resize){var d,e=this;c(window).on("resize.modal",function(){d&&clearTimeout(d);d=setTimeout(function(){for(var f=0;f<e.stack.length;f++)e.stack[f].isShown&&
e.stack[f].layout()},10)})}},createModal:function(a,b){c(a).modal(c.extend({manager:this},b))},appendModal:function(a){this.stack.push(a);var b=this;a.$element.on("show.modalmanager",g(function(){var d=function(){a.isShown=true;var e=c.support.transition&&a.$element.hasClass("fade");b.$element.toggleClass("modal-open",b.hasOpenModal()).toggleClass("page-overflow",c(window).height()<b.$element.height());a.$parent=a.$element.parent();a.$container=b.createContainer(a);a.$element.appendTo(a.$container);
b.backdrop(a,function(){a.$element.show();a.layout();a.$element.addClass("in").attr("aria-hidden",false);var f=function(){b.setFocus();a.$element.trigger("shown")};e?a.$element.one(c.support.transition.end,f):f()})};a.options.replace?b.replace(d):d()}));a.$element.on("hidden.modalmanager",g(function(){b.backdrop(a);if(a.$backdrop)c.support.transition&&a.$element.hasClass("fade")?a.$backdrop.one(c.support.transition.end,function(){b.destroyModal(a)}):b.destroyModal(a);else b.destroyModal(a)}));a.$element.on("destroy.modalmanager",
g(function(){b.removeModal(a)}))},destroyModal:function(a){a.destroy();var b=this.hasOpenModal();this.$element.toggleClass("modal-open",b);b||this.$element.removeClass("page-overflow");this.removeContainer(a);this.setFocus()},hasOpenModal:function(){for(var a=0;a<this.stack.length;a++)if(this.stack[a].isShown)return true;return false},setFocus:function(){for(var a,b=0;b<this.stack.length;b++)if(this.stack[b].isShown)a=this.stack[b];a&&a.focus()},removeModal:function(a){a.$element.off(".modalmanager");
a.$backdrop&&this.removeBackdrop.call(a);this.stack.splice(this.getIndexOfModal(a),1)},getModalAt:function(a){return this.stack[a]},getIndexOfModal:function(a){for(var b=0;b<this.stack.length;b++)if(a===this.stack[b])return b},replace:function(a){for(var b,d=0;d<this.stack.length;d++)if(this.stack[d].isShown)b=this.stack[d];if(b){this.$backdropHandle=b.$backdrop;b.$backdrop=null;a&&b.$element.one("hidden",g(c.proxy(a,this)));b.hide()}else a&&a()},removeBackdrop:function(a){a.$backdrop.remove();a.$backdrop=
null},createBackdrop:function(a){if(this.$backdropHandle){a=this.$backdropHandle;a.off(".modalmanager");this.$backdropHandle=null;this.isLoading&&this.removeSpinner()}else a=c('<div class="modal-backdrop '+a+'" />').appendTo(this.$element);return a},removeContainer:function(a){a.$container.remove();a.$container=null},createContainer:function(a){var b;b=c('<div class="modal-scrollable">').css("z-index",i("modal",a?this.getIndexOfModal(a):this.stack.length)).appendTo(this.$element);if(a&&a.options.backdrop!=
"static")b.on("click.modal",g(function(){a.hide()}));else a&&b.on("click.modal",g(function(){a.attention()}));return b},backdrop:function(a,b){var d=a.$element.hasClass("fade")?"fade":"",e=a.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(a.isShown&&e){e=c.support.transition&&d&&!this.$backdropHandle;a.$backdrop=this.createBackdrop(d);a.$backdrop.css("z-index",i("backdrop",this.getIndexOfModal(a)));a.$backdrop.addClass("in");this.backdropCount+=1;e?a.$backdrop.one(c.support.transition.end,
b):b()}else if(!a.isShown&&a.$backdrop){a.$backdrop.removeClass("in");this.backdropCount-=1;var f=this;c.support.transition&&a.$element.hasClass("fade")?a.$backdrop.one(c.support.transition.end,function(){f.removeBackdrop(a)}):f.removeBackdrop(a)}else b&&b()},removeSpinner:function(){this.$spinner&&this.$spinner.remove();this.$spinner=null;this.isLoading=false},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove();this.$backdropHandle=null;this.removeSpinner()},loading:function(a){a=
a||function(){};this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",c(window).height()<this.$element.height());if(this.isLoading)if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var b=this;c.support.transition?this.$backdropHandle.one(c.support.transition.end,function(){b.removeLoading()}):b.removeLoading()}else a&&a(this.isLoading);else{this.$backdropHandle=this.createBackdrop("fade");this.$backdropHandle.css("z-index",
i("backdrop",this.stack.length)).addClass("in");var d=c(this.options.spinner).css("z-index",i("modal",this.stack.length)).appendTo(this.$element).addClass("in");this.$spinner=c(this.createContainer()).append(d).on("click.modalmanager",c.proxy(this.loading,this));this.isLoading=true;c.support.transition?this.$backdropHandle.one(c.support.transition.end,a):a()}}};var i=function(){var a,b={};return function(d,e){if(typeof a==="undefined"){var f=c('<div class="modal hide" />').appendTo("body"),j=c('<div class="modal-backdrop hide" />').appendTo("body");
b.modal=+f.css("z-index");b.backdrop=+j.css("z-index");a=b.modal-b.backdrop;f.remove();j.remove()}return b[d]+a*e}}();c.fn.modalmanager=function(a,b){return this.each(function(){var d=c(this),e=d.data("modalmanager");e||d.data("modalmanager",e=new h(this,a));typeof a==="string"&&e[a].apply(e,[].concat(b))})};c.fn.modalmanager.defaults={backdropLimit:999,resize:true,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>'};
c.fn.modalmanager.Constructor=h})(jQuery);
